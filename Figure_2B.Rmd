---
title: "Figure_2B"
author: "Mike O'Donnell"
date: "6/19/2018"
output: html_document
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_chunk$set(message = FALSE)
knitr::opts_chunk$set(warning = FALSE)
library(ProvidenciaChemo)

```

```{r dataload}
library(tidyverse)
library(patchwork)

filepath <- here::here("extdata/Figure_2B.csv")

GPCR_data <- read.csv(filepath) %>%
  dplyr::filter(strain %in% c("OP50", "JUb39"), genotype != "tbh-1") %>% droplevels() %>%
  format_AvoidData(day.correct = "genotype") %>%
  mutate(plate = factor(seq(1:nrow(.))),
         genotype = factor(genotype, levels = c("N2","ser-3","octr-1","tyra-3","tyra-2","ser-1","dop_quad")))

plot = GPCR_data %>%
  plot_plasticityIndex(xvar = strain) + labs(title = "day corrected") +
  scale_color_plot(palette = "grey-blue", drop = TRUE) + guides(color = FALSE) + 
  facet_grid(.~genotype) +
  theme_my

plot

glmm <- lme4::glmer(data = GPCR_data, 
                    formula = cbind(nCue,nControl) ~ genotype * strain + (1 + strain | date) +  (1|plate),
                    family = binomial,
                    control= lme4::glmerControl(optimizer="bobyqa"))

lsm.list <- lsmeans::ref.grid(glmm) %>% lsmeans::lsmeans(., pairwise ~ strain | genotype) #%>% summary(adjust = "bon")
contrasts <- update(lsm.list$contrast, adjust = "mvt", by.vars = NULL)


sciplot::bargraph.CI(data = GPCR_data,
                     x.factor = genotype,
                     response = rel.Logit,
                     group = strain,
                     ylim = c(-0.75,3),
                     #ylim = c(-1,0.5),
                     col=rep(c("#827E7E","#484CC7"), 7),
                     space = (rep(c(0.2, 0.05), 7))
                     )

```
