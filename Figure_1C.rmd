---
title: "Figure 1C"
author: "Mike O'Donnell"
output:
  html_document:
    code_folding: hide
    fig_height: 5
    fig_width: 10
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_chunk$set(message = FALSE)
knitr::opts_chunk$set(warning = FALSE)
library(ProvidenciaChemo)

```

```{r SOS dataload}
cutoff <- 10 #cutoff time for binary
SOS <- read.csv(here::here("extdata","SOS_OP50_JUb39.csv")) %>%
  dplyr::filter(cond == "off_food", 
                                  genotype == "N2", 
                                  food %in% c("OP50", "JUb39"),
                                  response.time < 20,
                                  date %in% c("10_17_17", 
                                              "6_18_18", 
                                              "6_23_18",
                                              "23072018",
                                              "24072018",
                                              "20180904",
                                              "2018_10_23")) %>%
  mutate(food = factor(food, levels = c("OP50", "JUb39")))


lmm <- lme4::lmer(SOS, formula = log(response.time) ~ food + (1|date))

stan_glmm <- rstanarm::stan_glmer(SOS,
                                  formula = response.time ~ food + (1|date),
                                  family = lognormal)

brms::brm(data = SOS,formula = log(response.time) ~ food + (1|date),
                                  family = lognormal)

SOS %>% data_grid(food) %>%
  add_predicted_draws(stan_lmm, re_formula = NA) %>%
  mutate(response = .prediction) %>%
  ggplot(aes(y = food)) +
  geom_halfeyeh(aes(x = exp(response)))
         
         
         
           stat_pointinterval(aes(y=rel.Logit, x = 1.2),
                              fatten_point = 0,
                           size_range = c(0.3, 1), colour = "grey") +
        stat_summary(data = fitted,
                     aes(y=rel.Logit, x = 1.2),
                     fun.y = median,
                     fun.ymin = median,
                     fun.ymax = median,
                     geom = "crossbar",
                     width = 0.05,
                     lwd = 0.35,
                     colour = "grey")


##### plot 1 SOS OP50 v JUb39 ####

SOS_plot <- SOS %>% dplyr::filter(cond == "off_food", 
                                  genotype == "N2", 
                                  food %in% c("OP50", "JUb39"),
                                  response.time < 20,
                                  date %in% c("10_17_17", 
                                              "6_18_18", 
                                              "6_23_18",
                                              "23072018",
                                              "24072018",
                                              "20180904",
                                              "2018_10_23")) %>%
  ggplot(aes(x = food, y = response.time)) +
  ggbeeswarm::geom_quasirandom(aes(colour = food), width = 0.2) +
  scale_color_plot("grey-blue", drop = TRUE) +
  add.mean('response.time', colour = "red") +
  add.quartiles('response.time') +
  theme_my +
  labs(x = "food",
      y = "time to reversal (s)",
      title = "100% octanol") +
  #figure.axes(no.x = FALSE) +
  guides(color = FALSE)



```

